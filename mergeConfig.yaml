mixed-port: 7890
allow-lan: true
bind-address: '*'
mode: rule
log-level: info
external-controller: '127.0.0.1:9090'

dns:
  enabled: true
  listen: '127.0.0.1:3653'
  ipv6: true
  enhanced-mode: redir-host
  nameserver: [8.8.8.8, 8.8.4.4, 1.1.1.1, 208.67.222.222, 114.114.114.114]
  use-hosts: true
  hosts: { mtalk.google.com: [142.251.170.188, 108.177.125.188], alt1-mtalk.google.com: 192.178.164.188, alt2-mtalk.google.com: 192.178.164.188, alt3-mtalk.google.com: 192.178.164.188, alt4-mtalk.google.com: 192.178.164.188, alt5-mtalk.google.com: 192.178.164.188, alt6-mtalk.google.com: 192.178.164.188, alt7-mtalk.google.com: 192.178.164.188, alt8-mtalk.google.com: 192.178.131.188 }

profile:
  store-selected: true
  store-fake-ip: true
  proxy-groups-mode: true

proxies:

proxy-providers:
  xship:
    type: http
    url: "https://xship.top/v1/subscribe?starlink=SSYI1sE1b_KXI4PALsNsuyqQ"
    interval: 86400
    path: ./providers/xship.yaml
    health-check:
      enable: true
      url: 'https://www.google.com/generate_204'
      interval: 86400
  aifjj:
    type: http
    url: "https://www.a.aifjj.asia/api/v1/client/subscribe/3eddd42e9dc1e77d881326ad87da9246"
    interval: 86400
    path: ./providers/aifjj.yaml
    health-check:
      enable: true
      url: 'https://www.google.com/generate_204'
      interval: 86400
  config:
    type: http
    url: "https://raw.githubusercontent.com/iphoneten/api/refs/heads/main/config.yaml"
    interval: 86400
    path: ./providers/config.yaml
    health-check:
      enable: true
      url: 'https://www.google.com/generate_204'
      interval: 86400
  newcf:
    type: http
    url: "https://sub.dmit.dpdns.org/share/sub/dingyue_Center_newCF?token=RDAsvCX4jnVRs5imaSC3R"
    interval: 86400
    path: ./providers/newcf.yaml
    health-check:
      enable: true
      url: 'https://www.google.com/generate_204'
      interval: 86400
rule-providers:
  AntiAd:
    type: http
    behavior: domain
    url: "https://raw.githubusercontent.com/privacy-protection-tools/anti-AD/master/anti-ad-clash.yaml"
    path: ./ruleset/AntiAd.yaml
    interval: 86400

  banAD:
    type: http
    behavior: classical
    url: "https://raw.githubusercontent.com/ACL4SSR/ACL4SSR/refs/heads/master/Clash/Providers/BanAD.yaml"
    path: ./ruleset/BanAD.yaml
    interval: 86400

  adblockmihomo:
    type: http
    behavior: domain
    url: "https://raw.githubusercontent.com/217heidai/adblockfilters/main/rules/adblockmihomo.yaml"
    path: ./ruleset/adblockmihomo.yaml
    interval: 86400

  AD:
    type: http
    behavior: domain
    url: "https://raw.githubusercontent.com/earoftoast/clash-rules/main/AD.yaml"
    path: ./ruleset/AD.yaml
    interval: 86400

  ProgramAD:
    type: http
    behavior: domain
    url: "https://raw.githubusercontent.com/earoftoast/clash-rules/main/ProgramAD.yaml"
    path: ./ruleset/ProgramAD.yaml
    interval: 86400

  adblock_loyal:
    type: http
    behavior: domain
    url: "https://cdn.jsdelivr.net/gh/Loyalsoldier/clash-rules@release/reject.txt"
    path: ./ruleset/adblock_loyal.yaml
    interval: 86400
    
proxy-groups:
  - name: 负载均衡
    type: load-balance
    use: [newcf, xship, aifjj, config]
    interval: 300
    strategy: round-robin # 轮询方式，可选 'consistent-hashing' 'round-robin'
    url: 'http://cp.cloudflare.com/generate_204'
    max-failed-times: 3
    timeout: 5000 
    filter: ^(?!.*(剩余流量|套餐到期|距离下次|本站|关注|海外|官网|群组|🔒|免费|推广)).*$

  - name: 自动选择
    type: url-test
    use: [newcf, xship, aifjj, config]
    interval: 300
    url: 'http://cp.cloudflare.com/generate_204'
    max-failed-times: 3
    timeout: 5000 
    filter: ^(?!.*(剩余流量|套餐到期|距离下次|本站|关注|海外|官网|群组|🔒|免费|推广)).*$

  - name: 节点选择
    type: select
    proxies:
      - 自动选择
      - 负载均衡
    use: [newcf, xship, aifjj, config]
    url: 'http://cp.cloudflare.com/generate_204'
    timeout: 5000
    filter: ^(?!.*(剩余流量|套餐到期|距离下次|本站|关注|海外|官网|群组|🔒|免费|推广)).*$

rules:
  - RULE-SET,AD,REJECT
  - RULE-SET,adblockmihomo,REJECT
  # - RULE-SET,EasyList,REJECT
  # - RULE-SET,EasyListChina,REJECT
  # - RULE-SET,EasyPrivacy,REJECT
  - RULE-SET,ProgramAD,REJECT
  - RULE-SET,adblock_loyal,REJECT
  - RULE-SET,banAD,REJECT
  - RULE-SET,AntiAd,REJECT

  # 新增的直连规则
  - DOMAIN-SUFFIX,pages.dev,DIRECT
  
  - DOMAIN-SUFFIX,local,DIRECT
  - IP-CIDR,127.0.0.0/8,DIRECT
  - IP-CIDR,172.16.0.0/12,DIRECT
  - IP-CIDR,192.168.0.0/16,DIRECT
  - IP-CIDR,10.0.0.0/8,DIRECT
  - IP-CIDR,17.0.0.0/8,DIRECT
  - IP-CIDR,100.64.0.0/10,DIRECT
  - IP-CIDR,224.0.0.0/4,DIRECT
  - IP-CIDR6,fe80::/10,DIRECT
  - DOMAIN-SUFFIX,cn,DIRECT
  - DOMAIN-KEYWORD,-cn,DIRECT
  - GEOIP,LAN,DIRECT
  - GEOIP,CN,DIRECT
  - MATCH,节点选择
